<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>tree</title>
        <style>
            html, body, .treeBox {
                height: 100%;
            }
            .treeBox {
                position: relative;
                text-align: center;
            }
            .treeBox canvas {
                position: absolute;
                top: 50%;
                transform: translate(-300px, -300px);
                border: dashed 2px #ccc;
            }
        </style>
    </head>
    <body>
        <div class="treeBox">
            <canvas id='d1' width="600" height="600"></canvas>
        </div>
        <script>
            var canvas = document.getElementById('d1');
            var ctx = canvas.getContext('2d');
            var drawtree = function (ctx,startx,starty,length,angle,depth,branchWidth){
                var rand = Math.random,
                n_length,n_angle,n_depth,maxbranch = 4,
                endx,endy,maxangle = 2 * Math.PI / 4;
                var subbranch;
                ctx.beginPath();
                ctx.moveTo(startx,starty);
                endx = startx + length * Math.cos(angle);
                endy = starty + length * Math.sin(angle);
                ctx.lineCap = 'round';
                ctx.lineWidth = branchWidth;
                ctx.lineTo(endx,endy);
                if(depth<=1 ){
                    //树的枝干
                    ctx.strokeStyle = 'rgb(0,' + (((rand() * 64) +128) >>0) + ',0)';
                }
                else{
                    //树的叶子
                    ctx.strokeStyle = 'rgb(0,' + (((rand() * 64) +64) >>0) + ',50,25)';
                }
                ctx.stroke();
                n_depth = depth-1;
                //判断树是否结束
                if(!n_depth){
                    return;
                }
                subbranch = (rand() * (maxbranch-1)) + 1;
                branchWidth *= 0.5; 
                for(var i = 0; i<subbranch; i++){
                    n_angle = angle +rand() * maxangle -maxangle * 0.5;
                    n_length = length * (0.5 + rand() *0.5);
                    setTimeout(function (){
                        drawtree(ctx,endx,endy,n_length,n_angle,n_depth,branchWidth);
                        return;
                    },500)
                }
            }
            //初始化的树
            drawtree(ctx,300,470,100,-Math.PI / 2, 12, 12);
        </script>
    </body>
</html>